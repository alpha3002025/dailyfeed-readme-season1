**참고 : member-activity-svc (Season2 폐지 예정)**<br/>

`member-activity-svc` 의 경우 이번 프로젝트에 필요하지는 않지만 실무에서 kafka 를 쓸때 '메시지 유실' 관점에서의 PVC/MongoDB 영속화, 'Exactly Once' 를 Off 했을때 메시지의 중복수신 체크방법 등에 대해 다루기 위해 불가피하게 시나리오 기반으로 추가한 서비스입니다. 카프카 사용시 publish, listen 시 애플리케이션 레벨에서의 중복메시지 체크, 전송실패 처리 에 대한 주제가 자주 언급되고 중요하다고 여겨지기에 이번 프로젝트에 어느 정도의 역량이나 설계관점이 있는지를 소개하기 위해 소기능으로 추가했고, Season 2 에서 삭제하고 Feign 기반으로 전환할 예정입니다.<br/>

 Kafka 대신 feign 기반의 통신을 할 경우 어떻게 하는 지에 대해서도 예제를 작성했습니다.<br/>

개인적으로는 kubernetes 환경이 갖춰져 있다면, 웹소켓, 메시징 등의 상태없는 통신이 아닌 이상 Kafka/RabbitMQ 를 도입하기 보다는 kubernetes 기반의 스케일아웃이 용이한 환경을 통해 Feign 으로 통신을 하고, 통신실패의 경우 실시간 배치를 통해 후보정하는 것이 좋다고 생각합니다. Feign 을 사용할 경우 카프카에 비해 `STATUS_CODE` 를 더 다양하게 활용할수 있고, Rate Limiting, Circuit Breaker 도입이 가능하기 때문에, MSA 간 통신시에는 카프카 보다는 Feign 을 선호하는 편입니다. 카프카는 Publish 의 에러체크, Listen 시의 에러체크가 모두 필요하기에 카프카 통신 내에 트랜잭션이 섞일수록 점점 운영이 힘들어지는 것 같습니다.<br/>

member-activity-svc 도입시 카프카 관련 개념을 적용한 글들은 다음 글들에서 확인 가능합니다.
- [kafka/kafka-publish-listen-failover-batch](./kafka/kafka-publish-listen-failover-batch.md)



**content-svc, timeline-svc**<br/>

**content-svc**<br/>

content-svc 는 쓰기 트랜잭션을 수행하는 역할을 전담합니다. 글 생성/수정/삭제, 댓글,답글 생성/수정/삭제, 좋아요,좋아요 취소 트랜잭션 작업을 전담하며, 급작스러운 트래픽 증가나 장애 발생시 읽기 작업(조회/통계)에 영향을 주지 않기 위해 별도의 서비스로 분리했습니다. content-svc 에서는 하나의 트랜잭션에서 MySQL, MongoDB 에 저장/수정/삭제(or소프트삭제)를 수행합니다. MySQL 은 트랜잭션과 데이터의 조인, 정규화를 위한 저장소로 사용했으며, MongoDB 에는 MySQL 데이터의 pk 들을 보관하는 각각의 개별 인덱스를 보관하고 있습니다. MySQL, MongoDB 의 데이터 저장이 하나의 트랜잭션으로 이뤄지기에 데이터가 불일치하는 현상이 없음을 보장가능합니다. <br/>

<br/>



**timeline-svc**<br/>

좋아요 갯수, 댓글 갯수 등을 1건의 글에 대해서도 조회할 경우가 있지만, 피드 목록을 들고올때 각 글에 대한 좋아요 갯수, 댓글 갯수를 통계를 내야 할때가 있습니다. 이 경우 조회를 위해 사용하는 MongoDB 의 `posts`,`comments` 인덱스를 사용해 통계를 냅니다.<br/>

timeline-svc 에서는 단순히 MongoDB 만을 사용하지는 않습니다. 지금 가장 인기있는글, 댓글 많은 글, 팔로잉 멤버들의 최근 소식 등을 조회하는 SQL 이나 Querydsl 이 필요한 케이스의 경우 timeline-svc 를 사용하도록 했습니다.<br/>



**search-svc**<br/>

글, 댓글/답글의 본문 검색을 위한 서비스입니다. 형태소 분석이 용이한 MongoDB를 사용했으며, ElasticSearch 등을 사용할수도 있었겠지만, 개인 프로젝트 특성상 비용을 절감해야 했기에 MongoDB 를 사용했습니다.<br/>

<br/>



**image-svc**<br/>

S3 등을 사용할수도 있겠지만, 개인 프로젝트 특성상 비용지출을 최소한도로 해야했기에 PVC 기반의 deployment 기반으로 꾸렸습니다.<br/>

<br/>



**member-svc**<br/>

- (WIP) 문서 정리 예정