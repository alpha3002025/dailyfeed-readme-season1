**개인적으로는 kafka 보다는 feign 을 선호**<br/>
개인적으로는 kafka 보다는  feign 기반의 API 통신을 선호하는 편입니다. 가끔 애플리케이션의 스케일아웃을 카프카로 수행하려고 하는 Worst Case 를 실무에 적용하려 하는 분들을 본적이 있지만 말리지 않았던 경험이 있습니다. 저는 kafka 도입을 고려해야 하는 환경은 다음과 같다고 생각합니다.

- (1) MSA 환경에서 특정 서비스에서 발생한 이벤트를 브로드캐스팅해야 할때 
- (2) 실시간 메시징 기반의 처리가 필요할때

(1) 의 경우에는 배치 또는 feign 으로 해결할 수 있다면 가급적 배치 또는 feign 으로 해결하는 것도 좋은 방식이라고 생각합니다. 예를 들어 주문/결제 등에 대해 알림톡을 발송하고, 광고알고리즘 영역 역시 이를 개선해야 하는 경우가 있을 수 있습니다. 다만, 이 경우는 2개의 API 를 호출하는게 카프카를 도입하려고 고민할 정도로 큰 문제는 아니기에 카프카롤 도입할 고민을 할 필요가 없다고 생각합니다. 그냥 두 건의 API 만 발송하면 되기에 feign 을 통해 해당되는 API 서비스들에 관련 이벤트를 통보해주면 됩니다.<br/>

실무에서 kafka 를 만능인 것처럼 홀려서 사용하는 케이스를 몇번 본적이 있었는데, 다음과 같은 케이스에 `kafka`를 사용하는 것은 `Worst Case`이며, 운영비용을 올리고 장애 가능성을 높이며, 트러블 슈팅을 힘들게 하는 요소라고 생각합니다.
- (1) 배치 기반의 알림톡 발송을 `kafka` 기반으로 전환
- (2) 백엔드간 통신 시 부하가 많다고 느껴 `kafka` 기반으로 전환
<br/>

이 외에도 현업에서는 `kafka` 사용으로 인한 악습이 실제로 많이 있을 것으로 생각합니다. 실제 현업에서 목격한 건 위의 두 케이스였습니다. 실제로 목격했을 때 저는 아무것도 모른척 넘어가긴 했지만, (1) 의 케이스의 경우 알림톡 발송이 실패했을 때 데드레터 처리를 재귀적으로 처리해서 특정 사용자에게 메시지가 무한 발송되는 장애 케이스를 보기도 했고, 그걸 수정하면서 알림톡이 안가는 케이스도 본적이 있습니다.<br/>

feign 은 응답시에 응답코드도 다양하게 처리할 수 있고, 예외 코드도 다양하게 처리할수 있으며, Response Header 등을 통해 다양한 처리를 수행할 수 있다고 생각합니다. 애플리케이션의 레플리케이션 및 스케일아웃이 유연하게 구성될 수 있는 kubernetes 환경이 구축되어 있다면, 굳이 API 통신에 kafka 까지 사용해보려 고민하게 되지는 않을 것 같습니다.<br/>
<br/>

**kafka 를 도입할 때 어려워지는 부분들**<br/>
`kafka` 를 도입할 경우, 메시지 발송 시 통신레벨(L4)에서 보장하는 통신의 정합성 말고, 애플리케이션 레벨(L7)에서 통신이 정상적으로 수행되었음을 보장해야하고, 수신이 되었는지, 송신을 했는지 등을 체크해야하며, 경우의 수 역시 많아지기에 `kafka` 의 도입은 정말 신중하게 고려해야 한다고 생각합니다. 이런 문제 외에도 `kafka` 토픽을 어느샌가 알지도 못하는 서비스가 우후죽순으로 생기면서 토픽을 구독하는 서비스가 많아지면, 어디에 어떤 영향을 끼칠지 역시 파악이 안됩니다. 여기에 더해서 애플리케이션은 계속해서 개편 및 발전을 해나가기에 카프카 메시지의 버전 역시 계속 변하게 됩니다. 카프카 토픽을 구독하는 서비스가 많아질 때 여기에 대한 대응은 점점 어려워지게 됩니다.<br/>
<br/>

**dailyfeed 프로젝트에서는 ...** <br/>
위의 이유로 `kafka` 도입은 가급적 신중하게 생각합니다. 하지만, 이번 프로젝트에서는 `kafka` 사용시 어떤 점이 취약하고, 이런 부분에 대해서 어떻게 대응하는지, `kafka` 에 대한 기본적인 개념은 있는지 등을 프로젝트를 통해서 보증을 해야겠다고 생각해서 `dailyfeed-activity-svc`, `dailyfeed-content-svc` 와 함께 `kafka`를 사용하는 예제 케이스를 만들었습니다.<br/>

이번 `dailyfeed` 프로젝트에서 사용한 `kafka` 관련 인프라 셋업, `kafka` 관련 애플리케이션 코드 들은 다른 주제로 시작하려 계획 중인 피드 프로젝트인 `season 2` 에서는 모두 삭제 예정입니다.<br/>
<br/>
